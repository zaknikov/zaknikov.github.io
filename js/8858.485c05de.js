"use strict";(self["webpackChunkorbital"]=self["webpackChunkorbital"]||[]).push([[8858],{444328:function(t,i,e){e.r(i),e.d(i,{Animation:function(){return s}});class s{constructor(t,i,e,s){this._images=[],this._countSprite=i,this.imgLoaded=0,this._loadAnimation(t,e,s)}_loadAnimation(t,i,s){let n=[];for(let o=0;o<this._countSprite;o++){const i=new Promise(((i,n)=>{const a=t.replace("?",o),h=e(18116)("./"+a),r=new Image;r.src=h,this._images.push(r),r.addEventListener("load",(()=>{this.imgLoaded++,s(),i()})),r.addEventListener("error",(t=>{console.log(t),n(t)}))}));n.push(i)}Promise.all(n).then((()=>{i()})).catch((t=>{i(t)}))}findFrame(t){return this._images[t]}}},696762:function(t,i,e){e.r(i),e.d(i,{Animator:function(){return r}});e(21703);var s=e(444328),n=e(489520),o=e(816165),a=e(575174),h=e(539680);class r{constructor(t,i,e,s,n){this.canvasGroup=t,this.animationsPattern=i,this._options=e,this.hotspots,this._tilesCanvas=t.tilesCanvas,this._animCanvas=t.animation,this._eventsCanvas=t.eventsCanvas,this._hotspotRegions=s,this._regionInfo=n,this.init()}init(){this._currentWidth=0,this._currentHeight=0,this._countFrames=this._options.framesCount,this._tlTimeDraw=this._options.timeLineSpeed,this._animations=[],this.maxWidth=this._options.maxWidth,this.maxHeight=this._options.maxHeight,this._animationIndex=this._options.animStart,this._frameIndex=this._options.frameStart,this.mobileWidth=500,this._reverse=!1,this._isPlaying=!1,this._currentFrame,this._animationsReady=!1,this.cancel=!1,this._tilesController=null,this._resizer=null,this.percentLoaded=0,this._countAnimLoaded=0,this._zoomPoints=void 0,this._animCtx=this._animCanvas.getContext("2d"),this._tilesCtx=this._tilesCanvas.getContext("2d"),this._loadAnimations()}_loadAnimations(){console.log("loading..");let t=[];const i=this.animationsPattern.length*this._countFrames;for(let e=0;e<this.animationsPattern.length;e++){const n=new Promise(((t,n)=>{const o=this.animationsPattern[e],a=new s.Animation(o,this._countFrames,(i=>{this.cancel&&n("cancel"),"undefined"!==typeof i?n(i):t()}),(()=>{this._countAnimLoaded++,this.percentLoaded=Math.round(this._countAnimLoaded/i*100),window.dispatchEvent(new CustomEvent("OnLoadingChange",{bubbles:!1}))}));this._animations.push(a)}));t.push(n)}Promise.all(t).then((()=>{console.log("all animations loaded!"),this._animationsReady=!0,this._setup()})).catch((t=>{if("cancel"!==t)throw window.dispatchEvent(new CustomEvent("OnError",{bubbles:!1})),new Error("Error while loading animations! please check your images...")}))}_setup(){this._frameIndex=Math.min(Math.max(parseInt(this._frameIndex),0),this._countFrames-1),this._animationIndex=Math.min(Math.max(parseInt(this._animationIndex),0),this._animations.length-1),this._resizer=new h.Resizer(this.canvasGroup),this._initTiles(),this.hotspots=new n.Hotspots(this.canvasGroup,this._hotspotRegions,this._regionInfo),this._inputSystem=new a.InputSystem(this._eventsCanvas,{width:this.maxWidth,height:this.maxHeight},this._options.zoomOptions,this._options.dragOptions),this._inputSystem.rect.addEventListener("OnZoom",(()=>{this._onZoomEvent()})),this._inputSystem.rect.addEventListener("OnDrag",(t=>{this.onDragEvent(t)})),window.onresize=()=>{this._resizer.resize(),this._inputSystem.zoom.setMaxZoom(),this.requestFrameDraw()},window.dispatchEvent(new CustomEvent("OnAnimatorReady",{bubbles:!1}))}_initTiles(){this._tilesController=new o.TilesController(this._options)}run(){this._showAnimationFrame(this._animationIndex,this._frameIndex),this._options.autoplay&&window.setTimeout((()=>this.play()),0)}play(){this._isPlaying||(window.requestAnimationFrame((t=>{this._update(t)})),this._isPlaying=!0)}stop(){this._isPlaying&&(window.cancelAnimationFrame((t=>{this._update(t)})),this._isPlaying=!1)}_update(t){if(!this._animationsReady)return;void 0===this._startTime&&(this._startTime=t);const i=t-this._startTime;i>=this._tlTimeDraw&&this._isPlaying&&(this._step(),window.dispatchEvent(new CustomEvent("OnUpdateTimeline",{bubbles:!1})),this._startTime=t),window.requestAnimationFrame((t=>{this._update(t)}))}_step(t){t=void 0==t?this._reverse:t,t?this._setPrevIndex():this._setNextIndex(),this._showAnimationFrame(this._animationIndex,this._frameIndex)}requestFrameDraw(){window.requestAnimationFrame((()=>{this._draw()}))}_draw(){if(!this._animationsReady)return;const t=this._getAnimation();this._currentFrame=t.findFrame(this._frameIndex);const i=this._inputSystem.zoom.currentScale;this._currentWidth=this.maxWidth*i,this._currentHeight=this.maxHeight*i,this._setZoomOffset();let e=Math.round(.5*this._animCanvas.width-.5*this._currentWidth-this._offsetX),s=Math.round(.5*this._animCanvas.height-.5*this._currentHeight-this._offsetY);this._animCanvas.width<this.mobileWidth&&(e=Math.round(.5*this._animCanvas.width-.5*this._currentWidth),s=Math.round(.5*this._animCanvas.height-.5*this._currentHeight),this._offsetX=0,this._offsetY=0),this._tilesCtx.clearRect(0,0,this._tilesCanvas.width,this._tilesCanvas.height),this._animCtx.clearRect(0,0,this._animCanvas.width,this._animCanvas.height);const n=this._animationIndex,o=this._frameIndex,a=this._offsetX,h=this._offsetY,r=this._tilesController.fetchTiles(n,o,this._currentWidth,i);r.then((t=>{const r=this._inputSystem.zoom.currentScale;r===i&&n===this._animationIndex&&o===this._frameIndex&&a===this._offsetX&&h===this._offsetY&&this._tilesCtx.drawImage(t,e,s,this._currentWidth,this._currentHeight)})).catch((()=>{})),this.hotspots.drawHts(this._animationIndex,this._frameIndex,this._currentWidth,this._currentHeight,this._offsetX,this._offsetY),this._animCtx.drawImage(this._currentFrame,e,s,this._currentWidth,this._currentHeight)}_setZoomOffset(){if(void 0===this._offsetX&&(this._offsetX=0),void 0===this._offsetY&&(this._offsetY=0),void 0===this._zoomPoints)return;const t=.5*this._animCanvas.width,i=.5*this._animCanvas.height,e=t-.5*this._currentWidth+this._offsetX,s=i-.5*this._currentHeight+this._offsetY,n=e+.5*this._currentWidth,o=s+.5*this._currentHeight;let a,h;this._inputSystem.zoom.isZoomIn&&-1!=this._zoomPoints?(a=this._zoomPoints.x-n,h=this._zoomPoints.y-o):(a=t-n,h=i-o);const r=.1,c=.1*this._animCanvas.width,l=Math.atan2(h,a);let m=Math.sqrt(Math.pow(a,2)+Math.pow(h,2));m>c&&(m=c),this._offsetX+=Math.round(m*Math.cos(l)*r),this._offsetY+=Math.round(m*Math.sin(l)*r),this._zoomPoints=void 0}switchAnimation(t){t<0||t>=this._animations.length||this._showAnimationFrame(t,this._frameIndex)}_showAnimationFrame(t,i){this._animationIndex=t,this._frameIndex=i,this.requestFrameDraw()}playFrame(t){this.stop(),this._step(t)}_getAnimation(){return this._animations[this._animationIndex]}_setNextIndex(){this._frameIndex++,this._frameIndex>=this._countFrames&&(this._frameIndex=0)}_setPrevIndex(){this._frameIndex--,this._frameIndex<0&&(this._frameIndex=this._countFrames-1)}_onZoomEvent(){this._zoomLerp(),this.stop(),this.requestFrameDraw()}_zoomLerp(){const t=this._inputSystem.zoom.zoomPoints;this._zoomPoints=-1!=t?t:-1}onDragEvent(t){this.playFrame(t.detail)}}},354757:function(t,i,e){e.r(i),e.d(i,{CanvasBuilder:function(){return s}});e(21703);class s{constructor(t){this._parentId=t,this._parentElem}createLayers(){if(this._parentElem=document.getElementById(this._parentId),!this._parentElem)throw alert("Orbital dom element not found !! "+this._parentId),new Error("Orbital dom element not found !!"+this._parentId);const t=this.createCanvas("eventsCanvas",99),i=this.createCanvas("htEffectCanvas",5),e=this.createCanvas("htDrawCanvas",4),s=this.createCanvas("tilesCanvas",3),n=this.createCanvas("animCanvas",2),o=this.createCanvas("htRefCanvas",1);o.style.left="-300%",o.style.visibility="hidden";const a={animation:n,hotspotsRef:o,hotspotsDraw:e,hotspotsEffects:i,eventsCanvas:t,tilesCanvas:s};return a}createCanvas(t,i){if(null===this._parentElem)return;const e=document.createElement("canvas");return e.id=t,e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight,e.style.position="fixed",e.style.zIndex=i,e.style.top=0,e.style.left=0,this._parentElem.appendChild(e),e}}},251230:function(t,i,e){e.r(i),e.d(i,{Drag:function(){return s}});class s{constructor(t,i){this.rect=t,this._sensitivity=i.sensitivity,this._threshold=i.threshold,this._throwSens=i.throwSens,this._maxVelocity=i.maxVelocity,this._maxStepsCaptures=50,this.velocity=void 0,this.isDragging=!1,this.reverse=!0,this._prevX=void 0,this._prevT=void 0,this._lastDiff=void 0,this._bounding,this._waitTimout,this.init()}get _bounding(){return this.rect.getBoundingClientRect()}init(){this.clear()}clear(){this.isDragging=!1,this._prevX=void 0,this._prevT=void 0,this._lastDiff=void 0,clearTimeout(this._waitTimout)}mouseDown(t){this._startEvent(t.clientX)}mouseMove(t){this.isDragging&&this._rotate(t.clientX)}mouseUp(){this._endEvent()}touchStart(t){const i=t.touches;i.length>1?this.clear():this._startEvent(i[0].clientX)}touchMove(t){if(!this.isDragging)return;const i=t.touches;i.length>1?this.clear():this._rotate(i[0].clientX)}touchEnd(){this._endEvent()}_startEvent(t){this.isDragging=!0,this._prevX=this._getCurrentX(t),this._prevT=Date.now(),clearTimeout(this._waitTimout)}_endEvent(){this.isDragging=!1,this._throw(),this._lastDiff=void 0}async _rotate(t){const i=this._getCurrentX(t);this._lastDiff=Math.round(i-this._prevX);const e=Date.now(),s=e-this._prevT;if(this.velocity=Math.abs(this._lastDiff/s),Math.abs(this._lastDiff)>this._threshold){this.reverse=this._lastDiff>0;const t=Math.floor(this.velocity*this._sensitivity);for(let i=0;i<=t;i++)await this._wait(this.velocity),this.rect.dispatchEvent(new CustomEvent("OnDrag",{bubbles:!1,detail:this.reverse}));this._prevX=i,this._prevT=e}}async _throw(){const t=Math.abs(this._lastDiff);if(this.isDragging||void 0===this._lastDiff||t<this._threshold)return void this.clear();const i=this._lastDiff>0;let e=Math.round(Math.abs(this.velocity))*this._throwSens;e=e>this._maxStepsCaptures?this._maxStepsCaptures:e,this.velocity=this.velocity>this._maxVelocity?this._maxVelocity:this.velocity,this.velocity=this._maxVelocity-this.velocity;for(let s=0;s<e;s++){if(this.isDragging){this.clear();break}await this._wait(this.velocity),this.rect.dispatchEvent(new CustomEvent("OnDrag",{bubbles:!1,detail:i}));const t=this._easeOutSine(s/e);this.velocity+=t*this._sensitivity}}_easeOutSine(t){return Math.sin(t*Math.PI/2)}_wait(t){const i=new Promise((i=>{this._waitTimout=setTimeout((()=>{i()}),t)}));return i}_getCurrentX(t){return t-this._bounding.left}}},575174:function(t,i,e){e.r(i),e.d(i,{InputSystem:function(){return o}});var s=e(490842),n=e(251230);class o{constructor(t,i,e,o){this.rect=t,this.drag=new n.Drag(t,o),this.zoom=new s.Zoom(t,i,e),this.init()}_hasTouch(){return"ontouchstart"in window}init(){this._hasTouch()?(console.log("touch support"),this._touchListeners()):(this._mouseListeners(),this._pointerZoomEvent()),this.rect.addEventListener("wheel",(t=>{t.preventDefault(),this.zoom._wheelZoom(t)}))}_mouseListeners(){this.rect.onmousedown=t=>{0===t.button&&this._mouseDown(t)},this.rect.onmousemove=t=>{this._mouseMove(t)},this.rect.onmouseup=t=>{this._mouseUp(t)}}_touchListeners(){this.rect.addEventListener("touchstart",(t=>{this._touchStart(t)})),this.rect.addEventListener("touchmove",(t=>{t.preventDefault(),this._touchMove(t)}),{passive:!1}),this.rect.addEventListener("touchend",(t=>{this._touchEnd(t)}))}_pointerZoomEvent(){this.rect.addEventListener("pointerdown",(t=>{0===t.button?this.zoom.pointerStart(t):this.zoom.pointerEnd(t)})),this.rect.addEventListener("pointermove",(t=>{t.preventDefault(),this.zoom.pointerMove(t)})),this.rect.addEventListener("pointerup",(t=>{this.zoom.pointerEnd(t)})),this.rect.addEventListener("pointercancel",(t=>{this.zoom.pointerEnd(t)})),this.rect.addEventListener("pointerout",(t=>{this.zoom.pointerEnd(t)})),this.rect.addEventListener("pointerleave",(t=>{this.zoom.pointerEnd(t)}))}_mouseDown(t){this.drag._startEvent(t.clientX)}_mouseMove(t){this.zoom.isZooming?this.drag.clear():this.drag.mouseMove(t)}_mouseUp(t){this.drag.mouseUp(t)}_touchStart(t){const i=t.changedTouches;this.zoom.touchStart(t),this.drag._startEvent(i[0].clientX)}_touchMove(t){this.zoom.touchMove(t),this.zoom.isZooming?this.drag.clear():this.drag.touchMove(t)}_touchEnd(t){this.zoom.touchEnd(t),this.drag._endEvent()}}},490842:function(t,i,e){e.r(i),e.d(i,{Zoom:function(){return s}});class s{constructor(t,i,e){this.rect=t,this._naturalSizes=i,this.options=e,this.evCache=[],this.prevDiff=-1,this.prevTouchDiff=-1,this.isZooming=!1,this.zoomPoints=-1,this.init()}init(){this.defaultOptions={scaleFactor:.03,currentScale:.5,minScale:.26,maxScale:1,scaleMargins:.2,zoomInterval:16.66},this.setOptions(this.options),this.setMaxZoom()}setOptions(t){"undefined"==typeof t?this.options=this.defaultOptions:Object.keys(t).forEach((i=>{"undefined"!==typeof this.options[i]&&(this.options[i]=t[i])})),this.currentScale=this.options.initScale,this.scaleFactor=this.options.scaleFactor,this.minScale=this.options.minScale,this.maxScale=this.options.maxScale,this.scaleMargins=this.options.scaleMargins}touchStart(t){2===t.touches.length&&(this.isZooming=!0)}touchMove(t){if(2===t.touches.length){const i=Math.abs(t.touches[0].clientX-t.touches[1].clientX);if(this.prevTouchDiff>0){let e;i>this.prevTouchDiff&&(e=!0),i<this.prevTouchDiff&&(e=!1);const s=this._getPinchCenter(t.touches[1].clientX,t.touches[0].clientX,t.touches[1].clientY,t.touches[0].clientY);this._pinchZoom(e,s.xPoint,s.yPoint)}this.prevTouchDiff=i}}touchEnd(t){this.isZooming=!1,t.changedTouches.length<2&&(this.prevTouchDiff=-1)}pointerStart(t){this.evCache.push(t)}pointerMove(t){const i=this.evCache.findIndex((i=>i.pointerId===t.pointerId));if(this.evCache[i]=t,2===this.evCache.length){const t=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);if(this.prevDiff>0){let i=!0;t>this.prevDiff&&(i=!0),t<this.prevDiff&&(i=!1);const e=this._getPinchCenter(this.evCache[1].clientX,this.evCache[0].clientX,this.evCache[1].clientY,this.evCache[0].clientY);this._pinchZoom(i,e.xPoint,e.yPoint)}this.prevDiff=t}}pointerEnd(){this.isZooming=!1,this.evCache=[]}_getPinchCenter(t,i,e,s){const n=i-t,o=s-e,a=t+.5*n,h=e+.5*o;return{xPoint:a,yPoint:h}}_removeEvent(t){const i=this.evCache.findIndex((i=>i.pointerId===t.pointerId));this.evCache.splice(i,1)}setZoom(t){this._canZoom(t)&&(this.isZoomIn=t,this.isZooming=!0,this._limitScale(),this.zoomPoints=-1,this.rect.dispatchEvent(new CustomEvent("OnZoom",{bubbles:!1})),this.isZooming=!1)}_pinchZoom(t,i,e){this._canZoom(t)&&(this.isZoomIn=t,this.isZooming=!0,this._limitScale(),this._setZoomPoints(i,e),this.rect.dispatchEvent(new CustomEvent("OnZoom",{bubbles:!1})))}_wheelZoom(t){if(!this._canZoom(t.deltaY<0))return;this.isZoomIn=t.deltaY<0,this._limitScale();const i=t.clientX-this.rect.getBoundingClientRect().left,e=t.clientY-this.rect.getBoundingClientRect().top;this._setZoomPoints(i,e),this.rect.dispatchEvent(new CustomEvent("OnZoom",{bubbles:!1}))}_canZoom(t){const i=Date.now();void 0===this.zoomTimeStart&&(this.zoomTimeStart=i);const e=i-this.zoomTimeStart;if(e<=this.options.zoomInterval)return!1;if(this.zoomTimeStart=i,t){if(this.currentScale>=this.maxScale)return!1;this.currentScale+=this.scaleFactor}else{if(this.currentScale<=this.minScale)return!1;this.currentScale-=this.scaleFactor}return!0}_limitScale(){(this.currentScale>=this.maxScale||this.currentScale<=this.minScale)&&(this.currentScale=Math.min(Math.max(this.currentScale,this.minScale),this.maxScale))}setMaxZoom(){const t=this._naturalSizes.width;let i=document.documentElement.clientWidth/t;if(i+=this.scaleMargins,i>=1)this.currentScale=this.maxScale;else{if(i<=this.minScale)return this.maxScale=this.minScale,void(this.currentScale=this.minScale);this.maxScale=i,i<this.currentScale&&(this.currentScale=i)}}_setZoomPoints(t,i){this._canZoomInPoint()?this.zoomPoints={x:t,y:i}:this.zoomPoints=-1}_canZoomInPoint(){const t=.4,i=this.minScale+(this.maxScale-this.minScale)*t;return this.currentScale>i}}},489520:function(t,i,e){e.r(i),e.d(i,{Hotspots:function(){return o}});var s=e(976163),n=e(17639);class o{constructor(t,i,e){this._canvasGroup=t,this._hotspotRegions=i,this.regionsInfo=e,this.imgW,this.imgH,this.level=0,this.frame=0,this.htDrawCtx,this.htRefCtx,this.filtredRegions=[[[]]],this._uColorSet,this.filterOptions={},this._hsRefTimer,this._delayRefDraw=500,this._lastHovered=void 0,this.init()}init(){this.htDrawcanvas=this._canvasGroup.hotspotsDraw,this.htEffectCanvas=this._canvasGroup.hotspotsEffects,this.htRefCanvas=this._canvasGroup.hotspotsRef,this.htEvtCanvas=this._canvasGroup.eventsCanvas,this.htDrawCtx=this.htDrawcanvas.getContext("2d"),this.htEffectCtx=this.htEffectCanvas.getContext("2d"),this.htRefCtx=this.htRefCanvas.getContext("2d",{willReadFrequently:!0}),this.htEvtCtx=this.htRefCanvas.getContext("2d"),this.typesColors=n.hotspots.color_HS,this.setupFromXml(),this.drawHts(),this.hSEvents()}setupFromXml(){this._uColorSet=new Set,this._hotspotRegions.forEach((t=>{const i=t.$.id,e=this.regionsInfo[i].type,n=this.typesColors[e],o=.4;t.polygon.forEach((t=>{const e=t.$,a=parseInt(e.state),h=parseInt(e.column),r=this._formatPositions(e.vertices);let c=s.COLOR_HELPER.getUniqColor(this._uColorSet);this._uColorSet.add(c),c=s.COLOR_HELPER.hexToRgb(c);const l={name:i,polygon:r,colorRef:c,fillColor:n,alpha:o},m=s.COLOR_HELPER.getColorString(c);"undefined"===typeof this.filtredRegions[a]&&(this.filtredRegions[a]=[]),"undefined"===typeof this.filtredRegions[a][h]&&(this.filtredRegions[a][h]=[]),this.filtredRegions[a][h][m]=l}))})),this._hotspotRegions.length=0}drawHts(t,i,e,s,n,o){this.level=t,this.frame=i,this.imgW=e,this.imgH=s,this.offsetX=n,this.offsetY=o,this._drawHts()}_drawHts(){window.clearTimeout(this._hsRefTimer),this._clearCtx(this.htRefCtx),this._clearCtx(this.htEffectCtx),this.drawHotspots(),this._hsRefTimer=window.setTimeout((()=>{this.drawHotspotsRef()}),this._delayRefDraw)}drawHotspots(){this._clearCtx(this.htDrawCtx);const t=this._getCurrentRegion();void 0!=t&&Object.values(t).forEach((t=>{if(this.validate(t.name)){const i=t.polygon,e=s.COLOR_HELPER.getColorFill(s.COLOR_HELPER.hexToRgb(t.fillColor),t.alpha);this._drawPolygon(this.htDrawCtx,i,e,void 0,1)}}))}drawHotspotsRef(){const t=this._getCurrentRegion();void 0!=t&&(this._clearCtx(this.htRefCtx),Object.values(t).forEach((t=>{if(this.validate(t.name)){const i=t.polygon,e=s.COLOR_HELPER.getColorFill(t.colorRef,1);requestAnimationFrame((()=>this._drawPolygon(this.htRefCtx,i,e,void 0)))}})))}_drawPolygon(t,i,e,s,n=2){t.strokeStyle=s,t.lineWidth=1,t.fillStyle=e,t.lineWidth=n,t.beginPath();for(let o=0;o<i.length;o++){const e=i[o],s=Math.round(.5*(t.canvas.width-this.imgW)),n=Math.round(.5*(t.canvas.height-this.imgH)),a=e.x*this.imgW+s-this.offsetX,h=e.y*this.imgH+n-this.offsetY;t.lineTo(a,h)}t.fill(),t.closePath(),s&&t.stroke()}validate(t){const i=this.regionsInfo[t];if(void 0!==i){const t=parseInt(i.surface,10),e=i.type,s=this.filterOptions.surface,n=this.filterOptions.types;return void 0!==s&&void 0!==n&&(!(t<s.minSurface||t>s.maxSurface)&&!!n.includes(e))}return!1}setSurfaceFilter(t){this.filterOptions.surface={minSurface:t.min,maxSurface:t.max},this._updateHotspots()}setTypesFilter(t){this.filterOptions.types=t,this._updateHotspots()}_updateHotspots(){this._drawHts()}_formatPositions(t){let i=[];const e=t,s=e.split("|");for(let n=0;n<s.length;n++){const t=s[n].split(";");for(let e=0;e<t.length;e++){const s=t[e].split(",");i.push({x:s[0],y:s[1]})}}return i}hSEvents(){this.htEvtCanvas.addEventListener("mousemove",(t=>{this.mouseMoveEvent(t)})),window.PointerEvent?(this.htEvtCanvas.addEventListener("pointerdown",(t=>{this._startEvent(t)})),this.htEvtCanvas.addEventListener("pointerup",(t=>{this._canClick()&&this.clickEvent(t)}))):(this.htEvtCanvas.addEventListener("mousedown",(t=>{this._startEvent(t)})),this.htEvtCanvas.addEventListener("mouseup",(t=>{this._canClick()&&this.clickEvent(t)})),this.htEvtCanvas.addEventListener("touchstart",(t=>{this._startEvent(t)})),this.htEvtCanvas.addEventListener("touchend",(t=>{this._canClick()&&this.touchEvent(t)})))}mouseMoveEvent(t){const i=this._getHotspotData({x:t.clientX,y:t.clientY});void 0!==i?this._regionHoverState(i,{x:t.clientX,y:t.clientY}):this._regionOutState()}clickEvent(t){const i=this._getHotspotData({x:t.clientX,y:t.clientY});void 0!==i&&this._regionClickState(i,{x:t.clientX,y:t.clientY})}touchEvent(t){const i=t.changedTouches[0],e=this._getHotspotData({x:i.clientX,y:i.clientY});void 0!==e&&this._regionClickState(e,{x:i.clientX,y:i.clientY})}_startEvent(){this.timeStart=Date.now()}_canClick(){const t=Date.now(),i=t-this.timeStart;return i<300}_regionHoverState(t,i){const e=this._getSelectedHotspot(t);if(!e)return;const s=e.region;void 0===this._lastHovered?this._setHsEffect(s):this._lastHovered.name!==s.name&&(this._clearCtx(this.htEffectCtx),this._setHsEffect(s)),this.htEvtCanvas.style.cursor="pointer",window.dispatchEvent(new CustomEvent("OnHSHover",{bubbles:!1,detail:{mousePos:i,region:e.region}}))}_regionOutState(){void 0!==this._lastHovered&&(this._clearCtx(this.htEffectCtx),this._lastHovered=void 0),this.htEvtCanvas.style.cursor="default",window.dispatchEvent(new CustomEvent("OnHSHoverOut",{bubbles:!1}))}_regionClickState(t,i){this._regionOutState();const e=this._getSelectedHotspot(t);if(void 0===e)return;const s=e.region.name;window.dispatchEvent(new CustomEvent("OnHSClick",{bubbles:!1,detail:{mousePos:i,region:this.regionsInfo[s]}}))}_setHsEffect(t){this._drawPolygon(this.htEffectCtx,t.polygon,"transparent","#FFFFFF",2),this._lastHovered=t}_getHotspotData(t){const i=this.htDrawcanvas.getBoundingClientRect(),e=Math.round(t.x-i.left),s=Math.round(t.y-i.top),n=this.htRefCtx.getImageData(e,s,1,1),o=n.data;if(0!==o[0]||0!==o[1]||0!==o[2])return o}_getSelectedHotspot(t){const i=this._getCurrentRegion();if(void 0===i)return;const e={red:t[0],green:t[1],blue:t[2]},n=s.COLOR_HELPER.getColorString(e),o=i[n];return void 0!==o?{region:o}:void 0}_getCurrentRegion(){if("undefined"!==typeof this.filtredRegions[this.level]){if("undefined"!==typeof this.filtredRegions[this.level][this.frame])return this.filtredRegions[this.level][this.frame];this._clearCtx(this.htRefCtx)}else this._clearCtx(this.htRefCtx)}_clearCtx(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}}},438858:function(t,i,e){e.r(i),e.d(i,{Orbital:function(){return h}});var s=e(696762),n=e(354757),o=e(976163),a=e(17639);class h{constructor(t,i){this.xml,this.container=t,this._regionsInfo=i,this.animationsPaths=[],this.animator,this.canvasBuilder}init(){this.xml=new o.XmlManager("config.xml"),this.xml.loadXmlData((()=>{this.htFromXml=this.xml.getHotspots(),this._setup()}))}_setup(){const t=a.params,i=t.animationsCount;let e=t.imagesFolder+t.preloadedFolder;for(let s=0;s<i;s++){const t=e.replace(/%row/g,s).replace(/%col/g,"?");this.animationsPaths.push(t)}this.canvasBuilder=new n.CanvasBuilder(this.container);const o=this.canvasBuilder.createLayers(),h={maxWidth:t.maxWidth,maxHeight:t.maxHeight,imagesFolder:t.imagesFolder,framesCount:t.framesCount,timeLineSpeed:t.timeLineSpeed,autoplay:t.autoplay,frameStart:t.frameStart,animStart:t.animStart,tilesFolder:a.tiles.tilesFolder,breakpoints_sizes:a.tiles.breakpoints_sizes,breakpoints:a.tiles.breakpoints,breakpoints_folder:a.tiles.breakpoints_folder,maxCache:a.tiles.maxTilesCache,cropSize:a.tiles.cropSize,zoomOptions:a.controls.zoom,dragOptions:a.controls.drag};this.animator=new s.Animator(o,this.animationsPaths,h,this.htFromXml,this._regionsInfo),window.addEventListener("OnAnimatorReady",(()=>this.appReady()),{once:!0}),this._setConfigStyles()}_setConfigStyles(){void 0!==this.animator&&(document.getElementById(this.container).style.backgroundColor=a.params.bg_color)}appReady(){this.animationsPaths=null,this.animator.run(),window.dispatchEvent(new CustomEvent("OnAppReady",{bubbles:!1}))}getPercentLoaded(){return void 0===this.animator?0:this.animator.percentLoaded}playOrbital(){this.animator.play()}stopOrbital(){this.animator.stop()}next(){this.animator.playFrame(!1)}prev(){this.animator.playFrame(!0)}setLevel(t){this.animator.switchAnimation(t)}filterHSByPrice(t){void 0!==this.animator&&(this.animator.stop(),this.animator.hotspots.setSurfaceFilter(t))}filterHSByTypes(t){void 0!==this.animator&&(this.animator.stop(),this.animator.hotspots.setTypesFilter(t))}setZoomOptions(t){this.animator._inputSystem.zoom.setOptions(t)}setZoom(t){void 0!==this.animator&&this.animator._inputSystem.zoom.setZoom(t)}getParam(t){return a.params[t]}getHSParam(t){return a.hotspots[t]}getCurrentFrame(){if(void 0!==this.animator)return this.animator._frameIndex}unmountOrbital(){void 0!==this.animator&&(this.animator.cancel=!0)}}},539680:function(t,i,e){e.r(i),e.d(i,{Resizer:function(){return s}});class s{constructor(t){this.canvasObj=t,this.init()}init(){this.resize()}resize(){Object.values(this.canvasObj).forEach((t=>{t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight}))}}},816165:function(t,i,e){e.r(i),e.d(i,{TilesController:function(){return s}});e(21703);class s{constructor(t){if(this.options=t,"undefined"===typeof t.breakpoints_sizes&&"object"!==typeof t.breakpoints_sizes)throw alert("breakpoints not valid"),new Error("breakpoints not valid");this.naturalSizes=t.breakpoints_sizes,this.preloadedBP=this.naturalSizes.preloaded,this.cropSize=t.cropSize,this.maxCache=t.maxCache,this._currentNaturalWidth=null,this._animationIndex=0,this._currentFrame=0,this._currentBreakPoint,this._currentScale,this._cachedFrames=new Array,this._useCache=!0,this._timeOutLoad,this._firstFetch=!0,this.init()}init(){this._setLimitCache(),this.breakPoints=Object.entries(this.naturalSizes).sort((([,t],[,i])=>t-i)).reduce(((t,[i,e])=>({...t,[i]:e})),{})}_setLimitCache(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){if(!performance.memory)return void(this.maxCache=15);if(performance.memory.jsHeapSizeLimit<5e8)return void(this.maxCache=15)}}fetchTiles(t,i,e,s){if(this._setCurrentBP(e),this._setCurrentNaturalSize(this._currentBreakPoint),e<=this.preloadedBP)return this._loadTiles(!0);if(this._animationIndex=t,this._currentFrame=i,this._currentScale=s,this._firstFetch)return console.log("first fetch"),this._firstFetch=!1,this._loadTiles();if(this._useCache){const t=this._cachedFrames.find((t=>{if(t.animationIndex===this._animationIndex&&t.frame===this._currentFrame&&t.breakPoint===this._currentBreakPoint)return t}));if("undefined"!==typeof t)return this._loadExistingTiles(t)}return this._loadTiles()}_loadExistingTiles(t){return new Promise(((i,e)=>{t.animationIndex===this._animationIndex&&t.frame===this._currentFrame&&t.breakPoint===this._currentBreakPoint?i(t.canvas):e()}))}_loadTiles(t=!1){window.clearTimeout(this._timeOutLoad);const i=new Promise(((i,e)=>{t?e():this._timeOutLoad=window.setTimeout((()=>{const t=this._animationIndex,s=this._currentFrame,n=this._currentBreakPoint,o=this._currentScale,a=this._getTilesFolder(t,s,n);this._createAndLoadTiles(a,(a=>{if(this._useCache){const i={animationIndex:t,frame:s,breakPoint:n,canvas:a};this._addToCache(i)}this._canLoadImg(t,s,n,o)||e(),i(a)}))}),100)}));return i}_addToCache(t){this._cachedFrames.includes(t)||(this._checkCache(),this._cachedFrames.push(t))}_createAndLoadTiles(t,i){const s=this._currentNaturalWidth,n=this._calculateWithAspectRatio(s);let o=document.createElement("canvas"),a=o.getContext("2d");o.width=s,o.height=n;const h=this.cropSize,r=Math.floor(s/h),c=Math.floor(n/h),l=s%h,m=n%h,d=0!=l?r+1:r,_=0!=m?c+1:c;let u=new Array;for(let f=0;f<_;f++)for(let i=0;i<d;i++){const s=new Promise(((s,n)=>{let o=i*h,r=f*h;const c=d*f+i,l=`${t}p-${c}.jpg`,m=e(18116)("./"+l);let _=new Image;_.decoding="async",_.onload=()=>{a.drawImage(_,o,r),_=null,s()},_.onerror=()=>{_=null,n()},_.src=m}));u.push(s)}Promise.all(u).then((()=>{i(o),u=null}))}_canLoadImg(t,i,e,s){return t===this._animationIndex&&i===this._currentFrame&&e===this._currentBreakPoint&&s===this._currentScale}_draw(t,i,e,s){t.clearRect(e,s,t.canvas.width,t.canvas.height),t.drawImage(i,e,s)}_getTilesFolder(t,i,e){let s=this.options.imagesFolder+this.options.tilesFolder;for(const[n,o]of Object.entries(this.breakPoints))if(e===o){const e=this.options.breakpoints_folder[n];s=s.replace(/%row/g,t).replace("%bp",e).replace("%col",i);break}return s}_setCurrentNaturalSize(t){for(const[i,e]of Object.entries(this.breakPoints))if(e===t){this._currentNaturalWidth=this.naturalSizes[i];break}}_setCurrentBP(t){for(const[i=i,e]of Object.entries(this.breakPoints)){if(t<=e){this._currentBreakPoint=e;break}this._currentBreakPoint=e}}_checkCache(){if(this._cachedFrames.length>this.maxCache){let t=this._cachedFrames.shift();t.canvas=null,t=null}}_calculateWithAspectRatio(t){const i=this.options.maxWidth/this.options.maxHeight,e=t/i;return e}}}}]);
//# sourceMappingURL=8858.485c05de.js.map